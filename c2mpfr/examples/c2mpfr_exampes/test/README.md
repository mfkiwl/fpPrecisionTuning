This folder contains all required files obtained by following the procedures describes by 4 steps below. From this directory, you can run the search directly with 2 commands (because all files are obtained and ready to run): 

* Compile on new machine `gcc converted2mpfr.c -o test_mpfr -lmpfr`
* Run search: `python2 simple_sequential_search.py 123 test_mpfr`
To run the original code (in file fp_precision.c) with errror threshold = alpha (e.g. 1e-3 in this example). 

To generate all the required files in this folder, please follow the 4-steps procedures: 
### Step 1: Output format
Make sure the code output directly to stdout so the tool can compare the results. 
`fp_precision.c` needs to initialize some input and output `d` via printf as modified in `fp_precision_modified.c`
### Step 2: Convert to MPFR version
(this is not required if the original code already used other custom arithmetic library as flexfloat [https://github.com/oprecomp/flexfloat](https://github.com/oprecomp/flexfloat)). In this case, we need to convert since the original code is vanilla C. Steps to convert to mpfr:
from this directory, cd back to the `fpPrecisionTuning/c2mpfr/examples` folder where the c2mpfr.py script is located. 
* `cd ../../../`
run the conversion, there will be plenty of files generated.
* `./c2mpfr examples/c2mpfr_examples/test/fp_precision_modified.c`
copy the required files for searching (you can simply copy every generated file): 
* `cp converted2mpfr.c examples/c2mpfr_examples/test/`
* `cp dependency_graph.txt examples/c2mpfr_examples/test/`
* `cp config_file.txt examples/c2mpfr_examples/test/`
### Step 3: Generate reference output and mpfr executable: 
The reference output is generated by your program `fp_precision_modified.c`.
First compile it: 
`gcc fp_precision_modified.c -o test `

write reference output (value of variable d) to `target.txt`
`./test > target.txt`

Next we compile the mpfr version. 
`gcc converted2mpfr.c -o test_mpfr -lmpfr`

Finally we need a bash script to launch `test_mpfr`, the sample bash script(`.sh` extension) is given in every examples folder in `fpPrecisionTuning/c2mpfr/examples/c2mpfr_exampes` and `fpPrecisionTuning/SimpleSearch/benchmarks/` 

Simply do a copy : 
`cp ../dct_mpfr/dct_mpfr.sh ./test_mpfr.sh` 

modify the file name in the 4th line of the script `test_mpfr.sh` to run our program `test_mpfr`. It has been done and included in this folder. 

Sanity check to see whether everything is working :
`./test_mpfr.sh`, it should output something similar to the original program. 
### Step 4: set the error threshold and run the search 
Everything is set up, we can run the search now. For simple program and without the requirement of mpi4py module, you can use simplesequential search. Copy from the sample benchmarks: 

`cp ../../../../../SimpleSearch/benchmarks/dct/dct_mpfr/simple_sequential_search.py`

To set the error threshold, simply modify the line 36th of `simple_sequential_search.py` : 
(`error_rate = 1e-03 `, here you can set any other threshold).

The error metric is SQNR which is written in function `def check_output(floating_result, target_result):` in line 359. If the metrics is fine, you don't need to do anything. 

Run the search: 
`python2 simple_sequential_search.py 123 test_mpfr`

if the default python is python2, you can run like this  
`python simple_sequential_search.py 123 test_mpfr`

the output will be printed. like below: 
`[6, 3, 7, 7, 5]`

It is the mantissa bitwidth of each variable in the `converted2mpfr.c `, you can take a look and see which variable receives which bitwidth. 
